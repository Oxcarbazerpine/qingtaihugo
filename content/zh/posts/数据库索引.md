---
title: "数据库索引"
date: 2024-06-01
draft: false
tags: ["Database"]
---

## 索引是什么

一种存储了索引值和索引条目的磁盘地址或原始数据的数据结构。

## 常用数据结构：B+树

### 为什么不用其他数据结构

- **二叉树**  
  对递增索引会形成一个单向链表。

- **二叉平衡树（红黑树）**  
  每个节点存储索引和地址，自动平衡左右分支高度，早期MySQL曾使用。每层数据量少，树高太高，查找起来还是不够快。

- **B树**  
  多叉，每个节点存储索引和Data，索引从左向右递增，没有重复索引。

- **B+树**  
  MySQL使用，所有数据存在叶子节点，非叶子节点只存储冗余的头部索引（像单词表中的首字母索引），叶子节点之间用指针连接，以提高区间查找的性能。

### 特征

- 一种二叉树
- 每个节点有多个数据，MySQL一个节点有16KB大小
- 因为单个节点数据多，树的高度很低，一般3层

---

## 存储引擎 MyISAM 和 InnoDB

### 区别

- **MyISAM**  
  每个数据库存储在data目录下，每个数据库表文件中，MyISAM有3种文件，`.frm` 文件存储表结构，`.MYD`（D for data）存储原始数据，`.MYI`（I for index）存储表的索引，也就是B+树结构。为非聚集索引：数据和索引不聚集在一起存放，分成两个文件，索引只找出地址。

- **InnoDB**  
  库表文件中只有两种类型，`.frm` 存储表结构，`.idb` 存储数据和索引，对应行数据全部挂在叶子节点上，节省了按地址查找数据的一次I/O操作，为聚集索引（Clustered Index），性能更好。

### 联系

内部使用B+树，取到子节点后加载到内存进行内部的二分查找。

---

## 思考

### 为什么InnoDB建议建立主键索引，并且使用整型自增主键

- **为什么建立主键**  
  因为MySQL的查询逻辑是，首先必须建立B+树来组织数据，所以必须要有索引。如果是非主键索引，叶子节点存储的Data是对应行的主键的值，然后再进行一次主键索引查找。如果连非主键索引都没有，MySQL会在现有列中选择一列符合无重复的Unique的列来建立索引查找，如果没有这样的列，就建立一列隐藏列，用来建立索引。

- **为什么要用整数**  
  比对操作快，如果是字符串索引，需要逐位查找编码表（ASCII或者utf8等）表然后比较先后，这也是为什么不推荐使用是随机字符串的UUID。

- **为什么需要自增**  
  （此处原文未说明原因，可根据需要补充）

---

## 每个字段的索引可以设置，默认为B+ Tree，可以选择用Hash

### Hash

- MySQL有自己的hash实现
- 本质是数组+链表，hash计算查找值算出hash值，作为数组的key，数据作为数组的value；如果计算出的hash值重复了，即发生了hash碰撞，则数组value存储指向下一个链表节点的指针，直到链表末尾指向数据。
- 一般情况下查找速度甚至好于B+树，但是由于不能进行范围查找，没有被采用，因此如果不进行区间查找的场景可以考虑使用hash索引

